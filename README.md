# Pewlett Hackard Analysis

## Converting data from CSV to SQL Database
  The initial data is spread across 6 CSV files. The following ERD was created to visaulize the conections, and data types within the CSV files.

![EmployeeDB.png](https://github.com/jburs/Pewlett_Hackard_Analysis/blob/master/EmployeeDB.png)

  Using the ERD, a series of SQL queeries similar to the following were used to import the CSV data into SQL, and establish Keys and relationships. The full queerie is viewable in this repository as the schema. 

CREATE TABLE employees (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;emp_no INT NOT NULL,<br/>
    birth_date DATE NOT NULL,<br/>
    first_name VARCHAR NOT NULL,<br/>
    late_name VARCHAR NOT NULL,<br/>
    gender VARCHAR NOT NULL,<br/>
    hire_date DATE NOT NULL,<br/>
    PRIMARY KEY(emp_no)<br/>
    );<br/>

## Table 1: Number of Retiring Employees by Title
  The number of retiring employees by title was found by joining the employee number, first and last name, title, from date, and salary. These values were taken from the retirement_info, titles, and salaries data frames. Then joined together using the common key employee number. The retirement info data frame was generated from the employees data frame, where only employees that are elible to retire were selected. The number of retiring employees data frame was then partitioned, to remove duplicates created when eployees changed positions within the company, leaving only their current position. This final data frame is called 'retire_by_title'. It contains 41,380 employees that are retiring, meaning 41,380 employees will need to be hired to replace them. 

  Difficulties were encountered when constucting the code to eliminate duplicates columns. These were solved through reviewing references and further reading. 

The following query was used to generate the data. 

-- Number of Retiring Employees by Title<br/>
SELECT ri.emp_no,<br/>
    ri.first_name,<br/>
    ri.last_name,<br/>
    ti.title,<br/>
    ti.from_date,<br/>
    s.salary<br/>
INTO silver_tsunami<br/>
FROM retirement_info as ri<br/>
INNER JOIN titles as ti<br/>
ON (ri.emp_no = ti.emp_no)<br/>
INNER JOIN salaries as s<br/>
ON (ti.emp_no = s.emp_no)<br/>
ORDER BY emp_no ASC;<br/>

select * FROM silver_tsunami;<br/>

-- Partition the data to show only most recent title per employee<br/>
SELECT emp_no,<br/>
    first_name, <br/>
    last_name, <br/>
    title, <br/>
    from_date,<br/>
    salary<br/>
INTO retire_by_title<br/>
FROM <br/>
(SELECT emp_no,<br/>
    first_name, <br/>
    last_name, <br/>
    title, <br/>
    from_date,<br/>
    salary, ROW_NUMBER() OVER<br/>
    (PARTITION BY (emp_no)<br/>
    ORDER BY from_date DESC) rn<br/>
    FROM silver_tsunami<br/>
) tmp WHERE rn = 1<br/>
ORDER BY emp_no;<br/>

select * from retire_by_title;<br/>

select count(retire_by_title.emp_no) FROM retire_by_title;<br/>


## Table 2: Mentorship Eligibility
The mentorship elibility table, 'mentor_eligible.csv', contains data on employees born between January 1, 1965 and December 31, 1965. This table contains informatino of 1,940 employees that are eligilbe to become mentors. This data was generated by joining columns from the empoyees data set, and titles data set. Duplicates were then removed and the CSV was saved. 

SELECT e.emp_no,<br/>
    e.first_name,<br/>
    e.last_name,<br/>
    e.birth_date,<br/>
    ti.title,<br/>
    ti.from_date,<br/>
    ti.to_date<br/>
into mentor_eligible_rough<br/>
FROM employees as e<br/>
INNER JOIN titles as ti<br/>
ON (e.emp_no = ti.emp_no)<br/><br/>
WHERE (e.birth_date BETWEEN '1965-01-01' AND '1965-12-31')<br/><br/>
ORDER BY emp_no ASC;<br/><br/>

-- Partition the data to show only most recent title per employee<br/>
SELECT emp_no,<br/>
    birth_date,<br/>
    first_name, <br/>
    last_name, <br/>
    title, <br/>
    from_date,<br/>
    to_date<br/>
    INTO mentor_eligible<br/>
    FROM <br/>
(SELECT emp_no,<br/>
    birth_date,<br/>
    first_name, <br/>
    last_name, <br/>
    title, <br/>
    from_date,<br/>
    to_date, ROW_NUMBER() OVER<br/>
    (PARTITION BY (emp_no)<br/>
    ORDER BY from_date DESC) rn<br/>
    FROM mentor_eligible_rough<br/>
) tmp WHERE rn = 1<br/>
ORDER BY emp_no;<br/>

